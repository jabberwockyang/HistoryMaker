# History Maker

xswl这个名字真的好中二 我好喜欢 hhh

言归正传，这个东西主要目的是通过任务拆解提高病史整理质量
在llm处理病史的时候会出现缺项漏项，幻觉，用语不规范等问题。在 prompt 里体现后 gpt4其实 follow 很好 但是稍微普通些的模型好像不能一口气满足很多要求。于是想到了一个任务拆解的工作流

主要逻辑在 worker 中呈现，这里大概总结一下
- 首先根据病史的主要组成部分，将生成任务做拆分，分为生成主诉，生成现病史起病，主要症状描述，伴随症状巴拉巴拉
- 所有组分生成结束以后，再做用语专业化和内容去重的任务
- 最后按照一定的格式和逻辑把所有内容组分粘到一起

```python
self.BASIC_INFO_TEMPLATE = '请提取患者的基本信息：包含姓名、性别、年龄、职业、婚姻状况、住址。避免口语化表达，避免包含其他内容。示例：对话：……；基本信息：患者姓名张三，男，45岁，农民，不详，住址不详。对话：{}；基本信息：'
self.MAIN_SYMPTOM_TEMPLATE = '请提取患者的主诉：包含主要症状（或体征）及持续时间。避免口语化表达，避免包含其他内容。示例：对话：宝宝咳嗽，昨天开始，今天咳嗽比昨天多，有痰声，流鼻涕；主诉：咳嗽两天。对话：{}；主诉：'
self.PRESENT_HISTORY_ONSET_TEMPLATE = '请提取患者的现病史中的起病情况：记录发病的时间、地点、起病缓急、前驱症状、可能的原因或诱因。避免口语化表达，避免包含其他内容。示例：对话：……；现病史起病：患者于3天前发热，起病急，无明显前驱症状，无明显诱因。对话：{}；现病史起病：'
self.PRESENT_HISTORY_DESCRIPTION_TEMPLATE = '请提取患者的现病史中主要症状特点及其发展变化情况：按发生的先后顺序描述主要症状的部位、性质、持续时间、程度、缓解或加剧因素，以及演变发展情况。？避免口语化表达，避免包含其他内容。示例：对话：……；现病史描述：患者发热3天，体温最高38.5℃，伴咳嗽，咳痰，咳痰量约30ml/次，痰白色，无明显加重因素，无明显缓解因素。示例：对话：……；现病史描述：患者无其他伴随症状。对话：{}；现病史描述：'
self.PRESENT_HISTORY_ACCOMPANY_TEMPLATE = '请提取患者的现病史中伴随症状：记录伴随症状，描述伴随症状与主要症状之间的相互关系。避免口语化表达，避免包含其他内容。示例：对话：……；现病史伴随：伴咳嗽，咳痰，无胸痛，无咯血，无气促。对话：{}；现病史伴随：'
self.PRESENT_HISTORY_TREATMENT_TEMPLATE = '请提取患者此次就诊之前的诊治经过及结果，如无填写无。避免口语化表达，避免包含其他内容。示例：对话：……；现病史诊治：患者发病后就诊于当地医院，予以抗生素治疗，效果不佳，遂来我院就诊。对话：……；现病史诊治：患者此前未就诊。对话：{}；现病史诊治：'
self.PRESENT_HISTORY_GENERAL_TEMPLATE = '请提取患者的现病史中发病以来一般情况：简要记录患者发病后的精神状态、睡眠、食欲、大小便、体重等情况。避免口语化表达，避免包含其他内容。示例：对话：……；现病史一般情况：患者自发病以来精神状态一般，食欲减退，睡眠不好，大小便正常，体重无明显变化。示例：对话：……；现病史一般情况：患者一般情况无殊。对话：{}；现病史一般情况：'
self.EXAMINATION_TEMPLATE = '请提取患者的辅助检查：病人已有的检查项目、检查结果。避免口语化表达，避免包含其他内容。示例：对话：……；辅助检查：患者自发病以来查血常规：白细胞计数10.0×10^9/L。胸片：双肺纹理增多，未见实变。对话：……；辅助检查：无。对话：{}；辅助检查：'
self.PAST_HISTORY_TEMPLATE = '请提取患者的既往史：既往的健康状况、过去曾经患过的疾病等。避免口语化表达，避免包含其他内容。示例：对话：……；既往史：患者既往体健，无慢性病史，手术史不详，输血史不详。对话：{}；既往史：'
self.DIAGNOSIS_TEMPLATE = '请提取患者的诊断：对疾病的诊断。避免口语化表达，避免包含其他内容。示例：对话：……；诊断：急性支气管炎。对话：{}；诊断：'
self.SUGGESTION_TEMPLATE = '请提取患者的建议：检查建议、药物治疗、注意事项。避免口语化表达，避免包含其他内容。示例：对话：……；建议：1.继续抗生素治疗，2.注意休息，3.多饮水。对话：{}；建议：'
self.RPOFESSIONAL_EXPRESSION_TEMPLATE = '请把该段医学描述转化为专业表达，并按照要求删除多余的内容。示例：原句：3天拉不出粑粑，之前在小儿科就诊未见好转，要求：促使患者就诊的主要症状（或体征）及持续时间，专业表达：便秘3天。原句：{}，要求：{}，专业表达：'

```

作为一个经历过临床训练的医学生，我自己感官上能让输出好很多
有空上 medbench 测一下，作为一个 todo

chatclient 和 hybridserver 都是之前茴香豆那边搞来的代码 主要是贪恋里面写好的各路厂商的 response 解析，作者🐂🍺！